#!/usr/bin/env bash

function profile {
  # load this once per process
  local this_app="_app_$$"
  if [[ -n "${!this_app:-}" ]]; then
    return 0
  fi

  eval "${this_app}=1"

  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  PATH="$shome/bin:$shome/exec:$PATH"
  source "$shome/script/rc"

  if [[ -d "$shome/vendor/sub" ]]; then
    source "$shome/vendor/sub/script/profile"
  fi

  if [[ -d "$shome/vendor/jq" ]]; then
    source "$shome/vendor/jq/script/profile"
  fi

  if [[ -z "${APP_PATH:-}" ]]; then
    export APP_PATH="$(cd -P -- "${BASH_SOURCE%/*}/../.." && pwd -P)"
  fi

  source app_list
}

profile
