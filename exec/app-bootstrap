#!/usr/bin/env bash

function main {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"

  source "$shome/script/profile" || return 1

  for a in $(app runmany 'echo $1'); do
    pushd "$a"

    if [[ -x script/stale ]]; then
      if script/stale; then
        true
      else
        script/bootstrap
      fi
    elif [[ -x script/bootstrap ]]; then
      script/bootstrap
    fi

    if [[ -e script/profile ]]; then
      source script/profile
    fi

    popd
  done
}

source sub "$0" "$@"
